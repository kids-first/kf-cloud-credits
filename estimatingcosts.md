# Kids First Cloud Credit Program
## Estimating Cloud Computing Costs
_Note: While there are multiple cloud-based computing service providers, the Seven Bridges CAVATICA environment is built upon [Amazon Web Services (AWS)](https://aws.amazon.com/). The content of this page is specific to AWS and CAVATICA, most relevant to research on Kids First data._

Any analysis that has been performed locally can be run in the cloud. These could include large-scale workflows, such as genome alignment or gene expression quantification. They also could include smaller operations in an interactive session – reviewing the alignment in a genome browser or building a volcano plot from the gene expression values in the Data Cruncher’s R Studio.

---
### Storage and Compute
Users of cloud computing broadly pay for two categories of usage: ___storage___ and ___compute___.

___Storage___ refers to keeping files stored in the cloud, analogous to storing files on the hard drive on your computer.

All files uploaded to a CAVATICA project by a user incur storage costs. Additionally, any newly generated output files from user workflows also incur storage costs. The cost of storing files in the cloud is based on the size of the files and the length of time they are stored. Prices fluctuate but are generally around 2 cents per gigabyte per month. The most current rate is available in [AWS's documentation, linked here](https://aws.amazon.com/s3/pricing/). It is important to consider the files that will be generated by your workflow, estimate their sizes, and add this to your cloud credits budget.

There are no storage costs for Kids First files on CAVATICA that are accessed through the Kids First Portal using the “Analyze in CAVATICA” button in the File Repository. These include the harmonized genome alignments and variants identified through our workflows that serve as starting points for your analysis.

```
Important: Any files that incur storage costs – files uploaded by the user, intermediate files generated by bioinformatic workflows, output files, resulting graphs generated through analysis in the CAVATICA Data Cruncher – will continue to incur costs at the conclusion of your project. A clean-up plan is necessary for the conclusion of your project when credits are no longer available to support the storage of these on the platform.
```

___Compute___ refers to using workflows to run computation on files. Within the CAVATICA environment, this could be running a Task of an App in order to process genome files to call variants. It could also refer to using the Interactive Analysis, such as the Data Cruncher to run R scripts and generate graphical output. 

Compute in the cloud is billed on the size of the computer being run and the length of time it is being used. Prices vary based on the scale of the job, with current rates available in [AWS's documentation, linked here](https://aws.amazon.com/ec2/pricing/on-demand/)

---
### Estimating Analyses

___Using Existing Kids First DRC Workflows___

If you are looking to harmonize your existing data with Kids First Datasets, you may be interested in running one of the Kids First DRC's bioinformatic pipelines we use for our harmonized data. The provided costs are estimates used by the Kids First DRC for budgeting purposes for creating our harmonized genomic files using the listed workflows. Costs in the table represent reflect running the workflow one time using the given input.

| Pipeline | Input | Workflow | Cost |
| ----------- | ----------- | ----------- | ----------- | 
| [**Kids First DRC Alignment and GATK HaplotypeCaller Workflows**](https://github.com/kids-first/kf-alignment-workflow) | Single 120 GB WGS BAM file | _Realignment with AggMetrics, WgsMetrics, and gVCF creation_ |  $35 |
| [**Kids First DRC Joint Genotyping Workflow**](https://github.com/kids-first/kf-alignment-workflow) | Single 5GB gVCF | _VCF Creation_ | $2.25 |
| [**Kids First DRC Joint Genotyping Workflow**](https://github.com/kids-first/kf-alignment-workflow) | Trio of 6GB gVCFs | _VCF Creation_ | $3.25 |
| [**Kids First DRC Somatic Variant Workflow**](https://github.com/kids-first/kf-somatic-workflow) |  Paired Tumor & Normal CRAM Alignments | _4 SNV callers, consensus calling, annotation, CNVs, and SVs_  | $25 |
| [**Kids First RNA-Seq Workflow**](https://github.com/kids-first/kf-rnaseq-workflow) | Single-end FASTQ Input | _Alignment, Gene Expression Quantification, Gene Fusion ID_ | $5 |

___Bringing Your Own Workflows___

Users can also bring their own workflows into the cloud to analyze Kids First data in their own investigations. CAVATICA supports tools developed in the Common Workflow Language (CWL) with upcoming plans to support the Workflow Description Language (WDL) and NextFlow.

Computation costs in the cloud are a direct function of how long the user is running the computer, billed in dollars per hour. The long it takes the computer to run the assigned task depends on two factors. The nature of the task is of course important, with larger requests taking more time – aligning a genome will take longer than simply generating an index file. Additionally, the size of the input will also influence how long the task takes to complete – a 90 GB genome file will process quicker than a 120 GB genome file.

As such, it is difficult to predict an exact cost of a workflow before it has been run. We encourage you to develop a workflow and test your pipeline on a small number of samples to build an estimate before scaling to a complete analysis with a larger sample size.

The DRC has produced a [__Cloud Cost Estimator__](https://docs.google.com/spreadsheets/d/1_z6JxJxxbZj0qQ2-i6In2XntLkNDLiNB/edit?usp=sharing&ouid=114381528003679826426&rtpof=true&sd=true), a spreadsheet calculator that can predict cloud costs for benchmarked workflows. For computational costs, select AWS Instance from the drop down menu, the average length of time the workflow runs for, and the number of times the workflow needs to be run. For storage costs, enter an estimate for the size of each type of output as well as the number of files that will be produced. 
